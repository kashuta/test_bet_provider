# Тестовое задание для Backend Node.js разработчика

## Общая информация

Вам предстоит разработать небольшую систему, принимающую пользовательские ставки на определённые события (например, спортивные).

Система должна состоять из двух независимых сервисов:

1. **provider** — сервис, предоставляющий информацию о событиях.
2. **bet-platform** — сервис, принимающий ставки на эти события от пользователей.

## Описание сервиса provider

**provider** отвечает за предоставление информации о событиях, на которые можно делать ставки. В нашей упрощенной системе ставки принимаются только на победу первой команды.

### Требования к сервису:

- **Информация о событии** должна содержать:
  - Уникальный идентификатор события (строка или число).
  - Коэффициент ставки на победу первой команды (положительное число с двумя знаками после запятой).
  - Дедлайн для ставок (таймстемп, до которого принимаются ставки).
  - Текущий статус события:
    - **pending** — незавершённое.
    - **first_team_won** — завершено победой первой команды.
    - **second_team_won** — завершено победой второй команды.

### API сервиса provider:

#### **GET /events**

- **Описание**: Возвращает список всех событий с полной информацией.
- **Пример запроса**:

  ```http
  GET /events HTTP/1.1
  Host: provider.example.com
  ```

- **Пример ответа**:

  ```json
  [
    {
      "id": "event1",
      "coefficient": 1.75,
      "deadline": 1700000000,
      "status": "pending"
    },
    {
      "id": "event2",
      "coefficient": 2.10,
      "deadline": 1700003600,
      "status": "pending"
    }
  ]
  ```

#### **POST /events**

- **Описание**: Создаёт новое событие.
- **Тело запроса**:

  ```json
  {
    "coefficient": 1.85,
    "deadline": 1700007200
  }
  ```

- **Пример запроса**:

  ```http
  POST /events HTTP/1.1
  Host: provider.example.com
  Content-Type: application/json

  {
    "coefficient": 1.85,
    "deadline": 1700007200
  }
  ```

- **Пример ответа**:

  ```json
  {
    "id": "event3",
    "coefficient": 1.85,
    "deadline": 1700007200,
    "status": "pending"
  }
  ```

#### **PUT /events/:id**

- **Описание**: Обновляет статус существующего события.
- **Параметры пути**:
  - `id` — идентификатор события.
- **Тело запроса**:

  ```json
  {
    "status": "first_team_won"
  }
  ```

- **Пример запроса**:

  ```http
  PUT /events/event1 HTTP/1.1
  Host: provider.example.com
  Content-Type: application/json

  {
    "status": "first_team_won"
  }
  ```

- **Пример ответа**:

  ```json
  {
    "id": "event1",
    "coefficient": 1.75,
    "deadline": 1700000000,
    "status": "first_team_won"
  }
  ```

### Дополнительные требования:

- Данные могут храниться в памяти (in-memory), без использования сторонних хранилищ.
- Предусмотреть возможность динамически создавать новые события и менять статус существующих через API.
- При изменении статуса события сервис **provider** должен уведомить сервис **bet-platform** об этом изменении. Это можно реализовать через вызов callback URL или отправку сообщения в очередь.

## Описание сервиса bet-platform

**bet-platform** отвечает за приём ставок на события от пользователей и отслеживание результатов ставок.

### Требования к сервису:

- **Получение информации о событиях**:
  - Сервис должен получать актуальную информацию о событиях из **provider**.
  - Необходимо обеспечить механизм обновления статусов событий, чтобы определять, выиграла ставка или проиграла.
  - Взаимодействие между сервисами может быть реализовано одним из способов:
    - Периодические запросы к **provider** для обновления статусов.
    - Реализация webhook'а в **bet-platform**, который вызывается **provider** при изменении статуса события.
    - Использование очередей сообщений (например, RabbitMQ) для обмена информацией.

### API сервиса bet-platform:

#### 1. **GET /events**

- **Описание**: Возвращает список событий, на которые можно совершить ставку (события, для которых не наступил дедлайн).
- **Пример запроса**:

  ```http
  GET /events HTTP/1.1
  Host: bet-platform.example.com
  ```

- **Пример ответа**:

  ```json
  [
    {
      "id": "event2",
      "coefficient": 2.10,
      "deadline": 1700003600
    },
    {
      "id": "event3",
      "coefficient": 1.85,
      "deadline": 1700007200
    }
  ]
  ```

#### 2. **POST /bets**

- **Описание**: Совершает ставку на событие.
- **Тело запроса**:

  ```json
  {
    "eventId": "event2",
    "amount": 100.00
  }
  ```

- **Пример запроса**:

  ```http
  POST /bets HTTP/1.1
  Host: bet-platform.example.com
  Content-Type: application/json

  {
    "eventId": "event2",
    "amount": 100.00
  }
  ```

- **Пример ответа**:

  ```json
  {
    "betId": "bet1",
    "eventId": "event2",
    "amount": 100.00,
    "potentialWin": 210.00,
    "status": "pending"
  }
  ```

- **Валидация**:
  - Проверить, что событие существует и на него можно сделать ставку (дедлайн не наступил).
  - Сумма ставки — положительное число с двумя знаками после запятой.

#### 3. **GET /bets**

- **Описание**: Возвращает историю всех сделанных ставок.
- **Пример запроса**:

  ```http
  GET /bets HTTP/1.1
  Host: bet-platform.example.com
  ```

- **Пример ответа**:

  ```json
  [
    {
      "betId": "bet1",
      "eventId": "event2",
      "amount": 100.00,
      "potentialWin": 210.00,
      "status": "pending"
    },
    {
      "betId": "bet2",
      "eventId": "event1",
      "amount": 50.00,
      "potentialWin": 87.50,
      "status": "won"
    }
  ]
  ```

- **Статусы ставки**:
  - **pending** — ставка ещё не сыграла (событие не завершилось).
  - **won** — ставка выиграла.
  - **lost** — ставка проиграла.

### Хранение данных:

- Информация о ставках должна сохраняться в базе данных. Используйте **Prisma ORM** для взаимодействия с базой данных.
- Предпочтительно использовать **PostgreSQL** в качестве СУБД. Допускается использование SQLite для упрощения.

### Дополнительные требования:

- Обеспечить корректное обновление статусов ставок при изменении статусов событий.
- Реализовать обработку ошибок и возвращать информативные сообщения об ошибках клиенту.
- Обеспечить, чтобы данные о событиях и ставках были согласованными (например, использовать транзакции при необходимости).

## Общие требования к проекту

### Технологический стек:

- **Node.js** с использованием **Fastify** в качестве веб-фреймворка.
- **Prisma ORM** для работы с базой данных.
- Использование **REST API** или **GraphQL** (на выбор, но REST предпочтительнее для данного задания).
- Код должен быть написан на **TypeScript**.

### Качество кода:

- Соблюдение принципов чистого кода и лучших практик разработки.
- Структурированный и читаемый код с разбитием на модули.
- Документирование кода там, где это необходимо.

### Тестирование:

- Реализовать юнит-тесты для основных частей приложения.
- Использовать фреймворки для тестирования, такие как **Jest**.

### Документация:

- Описание запуска и использования приложения в файле **README.md**.
- Описание структуры API (можно использовать OpenAPI/Swagger или просто текстовое описание).

### Развёртывание:

- Предоставить файлы конфигурации для запуска приложения (например, **Dockerfile** и **docker-compose.yml**).
- Обеспечить возможность запуска приложения локально с минимальными усилиями.
- **Развернуть оба сервиса на бесплатных хостингах** (например, Heroku, Vercel, Render и т.д.).
  - Предоставить ссылки на работающие экземпляры сервисов.
  - Описать процесс деплоя в документации.

## Критерии оценки

- **Функциональность**: Насколько полно реализованы требования задания.
- **Качество кода**: Читаемость, структурированность, соблюдение лучших практик.
- **Тестирование**: Наличие и качество тестов.
- **Документация**: Полнота и ясность инструкции по запуску и использованию.
- **Обработка ошибок**: Корректная обработка исключений и ошибок, информативные сообщения для пользователя.
- **Технологии**: Соответствие использованных технологий заданным требованиям.
- **Развёртывание**: Успешный деплой сервисов на бесплатных хостингах и корректная работа приложений.

## Как отправить решение

- Загрузите код проекта на GitHub или другой сервис контроля версий.
- Убедитесь, что репозиторий публичный или предоставьте доступ.
- Отправьте ссылку на репозиторий и развернутые сервисы на электронную почту или через указанный канал связи.

## Дополнительные указания

- При возникновении вопросов или потребности в уточнениях, не стесняйтесь обращаться за разъяснениями.
- Помните, что задание призвано показать ваши навыки и подход к разработке, поэтому старайтесь писать код так, как вы бы делали это в реальном проекте.

Желаем удачи!
